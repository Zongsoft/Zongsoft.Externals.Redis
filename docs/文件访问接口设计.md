文件访问接口的数据表结构设计
======


### 文件容器表 [Storages_Bucket]

字段名称 | 数据类型 | 长度 | 可空 | 备注
---------|:--------:|:----:|:----:|:----|
BucketId | int | 4 | False | 文件容器编号，主键
Name | nvarchar | 100 | False | 容器名称
Path | nvarchar | 100 | False | 容器路径
Title | nvarchar | 100 | True | 容器标题
CreatedTime | datetime | - | False | 创建时间
ModifiedTime | datetime | - | True | 最后修改时间


### 文件表 [Storages_File]

字段名称 | 数据类型 | 长度 | 可空 | 备注
---------|:--------:|:----:|:----:|:----|
FileId | Guid | 16 | False | 文件编号，主键
BucketId | varchar | 50 | False | 存储容器名
Name | nvarchar | 100 | False | 文件名称(不含路径)
Type | varchar | 50 | False | 文件媒体类型
Size | int | 4 | False | 文件长度(单位:字节)
Path | nvarchar | 100 | False | 文件的完整路径
Title | nvarchar | 100 | True | 文件标题
CreatedTime | datetime | - | False | 创建时间
ModifiedTime | datetime | - | True | 最后修改时间
TotalVisits | int | 4 | False | 下载次数


## 非关系型数据库的结构设计

	storages.bucket:{bucket-id} [Hash, Dictionary]
	{
		Name : "Attachments"
		Path : "/attachments"
		Title : "附件容器"
		CreatedTime : 2014-07-20
		ModifiedTime : null
	}

	storages.file:{file-id} [Hash, Dictionary]
	{
		BucketId : {id}
		Name : "Popeye.jpg"
		Type : "image/jpeg"
		Size : 1024
		Path : "/{bucket.path}/$year/$month/$day/{file-name.ext}"
		CreatedTime : 2014-07-20
		ModifiedTime : null
		TotalVisits : 0
	}

	storages.bucket:{bucket-id}:files [Set, HashSet]
	[
		{file.id},
		{file.id},
		...
	]


## 接口API设计


### 文件容器操作
	/api/storages/bucket
	Controller: Bucket

- 获取文件容器信息
	获取指定文件容器的详细信息。

		Action: Get [GET]

- 获取文件容器列表
	获取当前用户的所有容器信息。

		Action: Get [GET]

- 创建文件容器
	创建一个文件存储容器。

		Action: Post [POST]

- 修改文件容器
	创建一个文件存储容器。

		Action: Put [PUT]

- 删除文件容器
	删除指定编号的文件容器，同时该容器下有文件将会被删除，请谨慎使用该方法。

		Action: Delete [DELETE, POST]


### 文件操作
	/api/storages/file
	Controller: File

- 创建文件
	创建一个文件。

		Action: Post [POST]
		Content-Type: multipart/form-data

	HTTP 请求包范例：

		POST /api/storages/file/1 HTTP/1.1
		Host: localhost:80
		Cache-Control: no-cache
		Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryp7MA4YWxkTrZu0gW

		----WebKitFormBoundaryE19zNvXGzXaLvS5C
		Content-Disposition: form-data; name="Attachment"; filename="File-Name.jpg"
		Content-Type: image/jpeg

		<binary-content>
		----WebKitFormBoundaryE19zNvXGzXaLvS5C

	HTTP 返回包范例：

		[
			{
				FileId: "12345678-0000-4fa5-8f3a-3744d216d475"
				BucketId: 1
				Name: "File-Name.jpg"
				Type: "image/jpeg"
				Path: "zfs.local:/d/attachments/2014/07/30/[1]1234567800004fa58f3a3744d216d475.jpg"
				Title: "Attachment"
				Size: xxxx
				TotalVisits: 1
				CreatedTime: "2014-07-30T17:18:19.7415531+08:00"
				ModifiedTime: null
			}
		]


- 获取文件信息
	获取指定文件的详细信息。

		Action: Info [GET]
		Content-Type: application/json

- 下载文件
	下载指定文件的内容。

		Action: Get [GET]
		Content-Type: {File.Type}

	HTTP 返回包范例：

		Cache-Control:no-cache
		Content-Disposition:attachment; filename=file-name.jpg
		Content-Length:xxxx
		Content-Type:image/jpeg
		Date:Wed, 30 Jul 2014 15:27:54 GMT
		Expires:-1
		Last-Modified:Wed, 30 Jul 2014 09:18:19 GMT
		Pragma:no-cache

- 删除文件
	删除指定的文件。

		Action: Delete [DELETE]
